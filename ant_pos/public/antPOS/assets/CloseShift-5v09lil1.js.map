{"version":3,"file":"CloseShift-5v09lil1.js","sources":["../../../../AntPos/node_modules/frappe-ui/src/components/Spinner/Spinner.vue","../../../../AntPos/src/component/Dialog/CloseShift.vue"],"sourcesContent":["<template>\n  <svg class=\"spinner\" viewBox=\"0 0 50 50\">\n    <defs>\n      <linearGradient id=\"gradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n        <stop offset=\"0%\" stop-color=\"rgba(0,110,219,1)\" />\n        <stop offset=\"100%\" stop-color=\"rgba(255,255,255,0)\" />\n      </linearGradient>\n    </defs>\n    <circle\n      stroke=\"url(#gradient)\"\n      class=\"spinner-path\"\n      cx=\"25\"\n      cy=\"25\"\n      r=\"20\"\n      fill=\"none\"\n      stroke-width=\"5\"\n    ></circle>\n  </svg>\n</template>\n<script lang=\"ts\" setup></script>\n<style scoped>\n.spinner {\n  animation: rotate 2s linear infinite;\n}\n.spinner-path {\n  stroke-linecap: round;\n  animation: dash 1.5s ease-in-out infinite;\n}\n\n@keyframes rotate {\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes dash {\n  0% {\n    stroke-dasharray: 1, 150;\n    stroke-dashoffset: 0;\n  }\n  50% {\n    stroke-dasharray: 90, 150;\n    stroke-dashoffset: -35;\n  }\n  100% {\n    stroke-dasharray: 120, 150;\n    stroke-dashoffset: -124;\n  }\n}\n</style>\n","<template>\n    <Dialog :options=\"{ size: '3xl' }\" v-model=\"dialogVisible\" >\n        <template #body-title>\n            <h3>ANT Closing Shift</h3>\n        </template>\n\n        <template #body-content>\n            <!-- Spinner at the top -->\n            <div class=\"w-full flex justify-center mb-2\" v-if=\"mode.isLoading\">\n                <Spinner class=\"w-5 h-5\" />\n            </div>\n\n            <table class=\"w-full mt-2\">\n                <thead>\n                    <tr class=\"text-left text-sm border-b\">\n                        <th class=\"pb-2 w-48\">Mode of Payment</th>\n                        <th class=\"pb-2 w-32\">Opening Amount</th>\n                        <th class=\"pb-2 w-32\">Closing Amount</th>\n                        <th class=\"pb-2 w-32\">Expected Amount</th>\n                        <th class=\"pb-2 w-32\">Difference</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr v-for=\"(row, index) in data\" :key=\"index\" class=\"border-b\">\n                        <td class=\"py-2 pr-4 w-48\">{{ row.mode_of_payment }}</td>\n                        <td class=\"py-2 px-1\">\n                            <FormControl\n                                type=\"number\"\n                                size=\"sm\"\n                                variant=\"subtle\"\n                                disabled=\"true\"\n                                v-model=\"row.opening\"\n                            />  \n                        </td>\n                        <td class=\"py-2 px-1\">\n                            <FormControl\n                                type=\"text\"\n                                inputmode=\"decimal\"\n                                step=\"any\"\n                                size=\"sm\"\n                                variant=\"subtle\"\n                                v-model=\"row.closing\"\n                                @input=\"updateDifference(index)\"\n                            />\n                        </td>\n                        <td class=\"py-2 px-1\">\n                            <FormControl\n                                type=\"number\"\n                                size=\"sm\"\n                                variant=\"subtle\"\n                                disabled=\"true\"\n                                v-model=\"row.expected\"\n                            />\n                        </td>\n                        <td class=\"py-2 px-1\">\n                            <FormControl\n                                type=\"number\"\n                                size=\"sm\"\n                                variant=\"subtle\"\n                                disabled=\"true\"\n                                :value=\"row.difference\"\n                            />\n                        </td>\n                    </tr>\n                </tbody>\n                <tfoot>\n                    <tr class=\"font-bold border-t\">\n                        <td class=\"py-2 pr-4\">Total</td>\n                        <td class=\"py-2 px-1\">{{ totals.opening }}</td>\n                        <td class=\"py-2 px-1\">{{ totals.closing }}</td>\n                        <td class=\"py-2 px-1\">{{ totals.expected }}</td>\n                        <td class=\"py-2 px-1\">{{ totals.difference }}</td>\n                    </tr>\n                </tfoot>\n            </table>\n\n            <div class=\"flex justify-end gap-2 mt-4\">\n                <Button variant=\"ghost\" @click=\"handleClose\">Cancel</Button>\n                <Button variant=\"solid\" @click=\"handleSubmit.fetch({ action: 'Submit' })\">Submit</Button>\n            </div>\n        </template>\n    </Dialog>\n</template>\n\n\n<script setup>\n    import { ref, inject, defineEmits, watch } from 'vue';\n    import { Button, Dialog, FormControl, createResource, debounce,Spinner} from 'frappe-ui';\n    import { createToast } from '../../utils';\n    import { useDynamicComponent } from '../../utils/Dialog';\n\n\n    const dialogVisible = ref(true);\n    const base = inject('base');\n    const openShiftVisible = ref(false);\n    const data = ref(base.pos_profile.payments);\n    let errorHandled = false;\n    const { currentComponent, loadComponent } = useDynamicComponent();\n    \n    const totals = ref({\n        opening: 0,\n        closing: 0,\n        expected: 0,\n        difference: 0,\n    });\n\n   const updateDifference = debounce((index) => {\n    const row = data.value[index];\n    if (row) {\n        row.difference = (row.expected || 0) - (row.closing || 0);\n        calculateTotals();\n    }\n}, 100);\n\n    let mode = createResource({\n        url: \"ant_pos.ant_pos.api.payment_entry.get_payments\",\n        method: \"POST\",\n        makeParams() {\n            return {\n                shift: base?.Ant_Opening_Shift?.name\n            };\n        },\n        auto: true,\n        onSuccess(closingData) {\n            \n            createClosingShift(closingData);\n        },\n    });\n\n    // const emits = defineEmits(['update:modelValue']);\n    const emit = defineEmits(['switchComponent']);\n\n    const createClosingShift = (closing) => {\n        const newData = [];\n\n        base.pos_profile.payments.forEach(element => {\n            const openingDetail = base.Ant_Opening_Shift.opening_balance_details.find(\n                item => item.mode_of_payment === element.mode_of_payment\n            );\n            \n            const closingDetail = closing.find(\n                item => item.mode_of_payment === element.mode_of_payment\n            );\n            \n            const openingAmount = Number(openingDetail?.opening_amount) || 0;\n            const closingTotal = Number(closingDetail?.total) || 0;\n            \n            newData.push({\n                mode_of_payment: element.mode_of_payment,\n                opening: openingAmount,\n                expected: closingTotal + openingAmount,\n                closing: closingTotal + openingAmount,\n                difference: 0, \n            });\n        });\n\n        data.value = newData;\n        calculateTotals();\n\n    };\n    const handleClose = async () => {\n        dialogVisible.value = false;\n        openShiftVisible.value = true;\n        \n        await loadComponent('OpenShift');\n\n        \n\n    };\n    const handleSubmit = createResource({\n        url: 'frappe.desk.form.save.savedocs',\n        makeParams(params) {\n            return {\n                doc: JSON.stringify(\n                    {\n                        doctype:\"Ant Closing Shift\",\n                        payment_reconciliation:data.value,\n                        ant_opening_shift: base?.Ant_Opening_Shift?.name,\n                    },\n                ),\n                action: params.action\n            }\n        },\n        async onSuccess(data) {\n        errorHandled = false;\n        \n        Object.assign(base, {\n            customer: {},\n            Ant_Opening_Shift: {},\n            items: [],\n            invoice: {},\n            page: '',\n        });\n        \n        dialogVisible.value = false;\n        \n        setTimeout(() => {\n            currentComponent.value = null;\n            emit('switchComponent', 'OpenShift');\n        }, 100);\n    },\n        onError(error) {\n                if (!errorHandled) {\n                    createToast({\n                        title: 'error',\n                        message: Array.isArray(error?.messages) ? error.messages[0] : error?.messages  || 'An error occurred',\n                        icon: 'x-circle',\n                        iconClasses: 'bg-surface-red-5 text-ink-white rounded-md p-px',\n                        position: 'top-center',\n                        timeout: 5,\n                    });\n                    errorHandled = true;\n                }\n        },\n    });\n\n    const calculateTotals = () => {\n        totals.value = {\n            opening: data.value.reduce((sum, row) => sum + (Number(row.opening) || 0), 0),\n            closing: data.value.reduce((sum, row) => sum + (Number(row.closing) || 0), 0),\n            expected: data.value.reduce((sum, row) => sum + (Number(row.expected) || 0), 0),\n            difference: data.value.reduce((sum, row) => sum + (Number(row.difference) || 0), 0),\n        };\n    };\n\n    watch(data, calculateTotals, { deep: true });\n\n    \n</script>"],"names":["_openBlock","_createElementBlock","_hoisted_1","_cache","_createElementVNode","dialogVisible","ref","base","inject","openShiftVisible","data","errorHandled","currentComponent","loadComponent","useDynamicComponent","totals","updateDifference","debounce","index","row","calculateTotals","mode","createResource","_a","closingData","createClosingShift","emit","__emit","closing","newData","element","openingDetail","item","closingDetail","openingAmount","closingTotal","handleClose","handleSubmit","params","error","createToast","sum","watch","_createBlock","_unref","Dialog","$event","_createVNode","Spinner","_hoisted_2","_Fragment","_renderList","_hoisted_3","_toDisplayString","_hoisted_4","FormControl","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","Button"],"mappings":"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","x_google_ignoreList":[0]}