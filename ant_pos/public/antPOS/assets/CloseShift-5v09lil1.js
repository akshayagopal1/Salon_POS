import{_ as E,Q as b,R as r,S as s,r as _,D as P,b3 as C,w as I,U as F,$ as g,a6 as L,u as a,Z as c,F as R,a9 as G,aa as p,aY as H,ac as k,ae as w,ba as J}from"./index-W9TX4JPH.js";import{u as M,c as Q,_ as y}from"./Pos-DZFo8QfI.js";const Y={},Z={class:"spinner",viewBox:"0 0 50 50"};function q(A,m){return r(),b("svg",Z,m[0]||(m[0]=[s("defs",null,[s("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[s("stop",{offset:"0%","stop-color":"rgba(0,110,219,1)"}),s("stop",{offset:"100%","stop-color":"rgba(255,255,255,0)"})])],-1),s("circle",{stroke:"url(#gradient)",class:"spinner-path",cx:"25",cy:"25",r:"20",fill:"none","stroke-width":"5"},null,-1)]))}const K=E(Y,[["render",q],["__scopeId","data-v-5c03f65e"]]),W={key:0,class:"w-full flex justify-center mb-2"},X={class:"w-full mt-2"},ee={class:"py-2 pr-4 w-48"},te={class:"py-2 px-1"},se={class:"py-2 px-1"},ne={class:"py-2 px-1"},ae={class:"py-2 px-1"},oe={class:"font-bold border-t"},le={class:"py-2 px-1"},ie={class:"py-2 px-1"},ce={class:"py-2 px-1"},de={class:"py-2 px-1"},ue={class:"flex justify-end gap-2 mt-4"},me={__name:"CloseShift",emits:["switchComponent"],setup(A,{emit:m}){const f=_(!0),o=P("base"),N=_(!1),i=_(o.pos_profile.payments);let v=!1;const{currentComponent:O,loadComponent:T}=M(),u=_({opening:0,closing:0,expected:0,difference:0}),U=H(t=>{const e=i.value[t];e&&(e.difference=(e.expected||0)-(e.closing||0),h())},100);let $=C({url:"ant_pos.ant_pos.api.payment_entry.get_payments",method:"POST",makeParams(){var t;return{shift:(t=o==null?void 0:o.Ant_Opening_Shift)==null?void 0:t.name}},auto:!0,onSuccess(t){B(t)}});const z=m,B=t=>{const e=[];o.pos_profile.payments.forEach(n=>{const d=o.Ant_Opening_Shift.opening_balance_details.find(S=>S.mode_of_payment===n.mode_of_payment),l=t.find(S=>S.mode_of_payment===n.mode_of_payment),x=Number(d==null?void 0:d.opening_amount)||0,V=Number(l==null?void 0:l.total)||0;e.push({mode_of_payment:n.mode_of_payment,opening:x,expected:V+x,closing:V+x,difference:0})}),i.value=e,h()},j=async()=>{f.value=!1,N.value=!0,await T("OpenShift")},D=C({url:"frappe.desk.form.save.savedocs",makeParams(t){var e;return{doc:JSON.stringify({doctype:"Ant Closing Shift",payment_reconciliation:i.value,ant_opening_shift:(e=o==null?void 0:o.Ant_Opening_Shift)==null?void 0:e.name}),action:t.action}},async onSuccess(t){v=!1,Object.assign(o,{customer:{},Ant_Opening_Shift:{},items:[],invoice:{},page:""}),f.value=!1,setTimeout(()=>{O.value=null,z("switchComponent","OpenShift")},100)},onError(t){v||(Q({title:"error",message:Array.isArray(t==null?void 0:t.messages)?t.messages[0]:(t==null?void 0:t.messages)||"An error occurred",icon:"x-circle",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:5}),v=!0)}}),h=()=>{u.value={opening:i.value.reduce((t,e)=>t+(Number(e.opening)||0),0),closing:i.value.reduce((t,e)=>t+(Number(e.closing)||0),0),expected:i.value.reduce((t,e)=>t+(Number(e.expected)||0),0),difference:i.value.reduce((t,e)=>t+(Number(e.difference)||0),0)}};return I(i,h,{deep:!0}),(t,e)=>(r(),F(a(J),{options:{size:"3xl"},modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=n=>f.value=n)},{"body-title":g(()=>e[2]||(e[2]=[s("h3",null,"ANT Closing Shift",-1)])),"body-content":g(()=>[a($).isLoading?(r(),b("div",W,[c(a(K),{class:"w-5 h-5"})])):L("",!0),s("table",X,[e[4]||(e[4]=s("thead",null,[s("tr",{class:"text-left text-sm border-b"},[s("th",{class:"pb-2 w-48"},"Mode of Payment"),s("th",{class:"pb-2 w-32"},"Opening Amount"),s("th",{class:"pb-2 w-32"},"Closing Amount"),s("th",{class:"pb-2 w-32"},"Expected Amount"),s("th",{class:"pb-2 w-32"},"Difference")])],-1)),s("tbody",null,[(r(!0),b(R,null,G(i.value,(n,d)=>(r(),b("tr",{key:d,class:"border-b"},[s("td",ee,p(n.mode_of_payment),1),s("td",te,[c(a(y),{type:"number",size:"sm",variant:"subtle",disabled:"true",modelValue:n.opening,"onUpdate:modelValue":l=>n.opening=l},null,8,["modelValue","onUpdate:modelValue"])]),s("td",se,[c(a(y),{type:"text",inputmode:"decimal",step:"any",size:"sm",variant:"subtle",modelValue:n.closing,"onUpdate:modelValue":l=>n.closing=l,onInput:l=>a(U)(d)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),s("td",ne,[c(a(y),{type:"number",size:"sm",variant:"subtle",disabled:"true",modelValue:n.expected,"onUpdate:modelValue":l=>n.expected=l},null,8,["modelValue","onUpdate:modelValue"])]),s("td",ae,[c(a(y),{type:"number",size:"sm",variant:"subtle",disabled:"true",value:n.difference},null,8,["value"])])]))),128))]),s("tfoot",null,[s("tr",oe,[e[3]||(e[3]=s("td",{class:"py-2 pr-4"},"Total",-1)),s("td",le,p(u.value.opening),1),s("td",ie,p(u.value.closing),1),s("td",ce,p(u.value.expected),1),s("td",de,p(u.value.difference),1)])])]),s("div",ue,[c(a(k),{variant:"ghost",onClick:j},{default:g(()=>e[5]||(e[5]=[w("Cancel",-1)])),_:1,__:[5]}),c(a(k),{variant:"solid",onClick:e[0]||(e[0]=n=>a(D).fetch({action:"Submit"}))},{default:g(()=>e[6]||(e[6]=[w("Submit",-1)])),_:1,__:[6]})])]),_:1},8,["modelValue"]))}};export{me as default};
//# sourceMappingURL=CloseShift-5v09lil1.js.map
