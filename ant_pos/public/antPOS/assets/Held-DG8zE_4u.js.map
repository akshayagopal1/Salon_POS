{"version":3,"file":"Held-DG8zE_4u.js","sources":["../../../../AntPos/src/components/Dialog/Held.vue"],"sourcesContent":["<template>\n    <Dialog :options=\"{ size: '3xl' }\" v-model=\"dialogVisible\"  class=\"rounded-b\">\n        <template #body-title>\n            <p class=\"text-3xl\" style=\"color: #4e60ac !important; font-family: 'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; font-size: 17px !important;\">Select Invoice</p>\n        </template>\n        <template #body-content>\n            <div class=\"w-full h-[60vh] rounded-2xl p-3 shadow-2xl flex flex-col gap-4\" style=\"background-color: #ffffff !important; color: #82868f !important; font-family: 'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; font-size: 17px !important;\">\n                <TextInput type=\"text\" v-model=\"searchQuery\" placeholder=\"Search\">\n                    <template #prefix>\n                        <FeatherIcon class=\"w-4\" name=\"search\" />\n                    </template>\n                </TextInput>\n                <div class=\"flex justify-evenly rounded-md p-3 h-[8%]\" style=\"background-color: #4e60ac !important; color: white !important; font-family: 'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; font-size: 17px !important;\">\n                    <div class=\"w-[10%]\"></div>\n                    <p class=\"w-[30%]\">Name</p>\n                    <p class=\"w-[30%]\">Customer</p>\n                    <p class=\"w-[30%]\">Amount</p>\n                </div>\n                <div class=\"h-[82%] overflow-y-scroll scrollbar-hide\">\n                    <div v-for=\"invoice in filteredInvoices\" :key=\"invoice.name\" class=\"flex flex-col\">\n                        <div class=\"flex justify-evenly rounded p-2.5 my-2\" style=\"background-color: #f8f8fc !important; color: #82868f !important; font-family: 'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; font-size: 17px !important;\">\n                            <div class=\"w-[10%]\">\n                                <input type=\"radio\" name=\"selectedInvoice\" :value=\"invoice.name\"\n                                    class=\"text-black hover:text-black\" v-model=\"selectedInvoice\" />\n                            </div>\n                            <p class=\"w-[30%]\">{{ invoice.name }}</p>\n                            <p class=\"w-[30%]\">{{ invoice.customer }}</p>\n                            <p class=\"w-[30%]\">{{ invoice.grand_total }}</p>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"flex justify-between items-center mt-4\">\n                    <div class=\"flex gap-2\">\n                        <Button\n                            v-for=\"size in [20, 100, 500, 2500]\"\n                            :key=\"size\"\n                            :variant=\"selectedPageLength === size ? 'solid' : 'ghost'\"\n                            @click=\"setPageLength(size)\"\n                            :ref_for=\"true\"\n                            :loading=\"invoices.loading\"\n                            :disabled=\"invoices.loading\"\n                            :link=\"null\"\n                            style=\"background-color: #4e60ac !important; border-color: #4e60ac !important; color: white !important; font-family: 'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; font-size: 17px !important;\"\n                        >\n                            {{ size }}\n                        </Button>\n\n                    </div>\n                    <Button \n                        @click=\"invoices.next()\" \n                        variant=\"solid\"\n                        :loading=\"invoices.loading\"\n                        :disabled=\"invoices.loading\"\n                        style=\"background-color: #4e60ac !important; border-color: #4e60ac !important; color: white !important; font-family: 'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; font-size: 17px !important;\"\n                    >\n                        Next\n                    </Button>\n                </div>\n            </div>\n        </template>\n        <template #actions>\n            <div class=\"\">\n                <Button variant=\"solid\" @click=\"submitInvoice\" style=\"background-color: #4e60ac !important; border-color: #4e60ac !important; color: white !important; font-family: 'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; font-size: 17px !important;\">Select</Button>\n                <Button class=\"ml-2\" @click=\"handleDialogClose\" style=\"background-color: #82868f !important; border-color: #82868f !important; color: white !important; font-family: 'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; font-size: 17px !important;\">Close</Button>\n            </div>\n        </template>\n    </Dialog>\n</template>\n\n<script setup>\nimport { Dialog, Button, createListResource, createResource, TextInput, FeatherIcon } from 'frappe-ui';\nimport { ref, inject, computed, watch } from 'vue';\nimport { createToast } from '../../utils';\n\nlet base = inject('base');\nconst dialogVisible = ref(true);\nconst selectedInvoice = ref(null);\nconst searchQuery = ref(\"\");\nlet errorHandled = false;\nconst selectedPageLength = ref(20);\n\nconst handleDialogClose = () => { dialogVisible.value = false; };\n\nconst setPageLength = (size) => {\n    if (selectedPageLength.value !== size) {\n        selectedPageLength.value = size;\n        invoices.update({ pageLength: size, start: 0 }); // Reset to first page\n        invoices.reload();\n    }\n};\nconst submitInvoice = () => {salesInvoice.fetch({ name: selectedInvoice.value });};\n\nlet salesInvoice = createResource({\n    url: 'frappe.desk.form.load.getdoc',\n    makeParams(params) {\n        return {\n            doctype: \"Sales Invoice\",\n            name: params.name\n        };\n    },\n    transform(data){\n        if (data.docs[0] && data.docs[0].items && data.docs[0].items.length > 0) {\n            data.docs[0].items.forEach(item => {\n                if (item.serial_no) {\n                    item.selected_serial_no = item.serial_no.trim().split('\\n').map(serial => ({\n                        label: serial,\n                        value: serial\n                    }));\n                    \n                }\n                if (item.batch_no) {\n                    \n                    item.selected_batch_no = {\n                        label: item.batch_no,\n                        value: item.batch_no\n                    };\n                } else {\n                    item.selected_batch_no = null;\n                }\n                if (!item.custom_id) {\n                    item.custom_id = Date.now() + Math.random();\n                }\n            });\n            \n        }\n        return data\n    },\n    onSuccess: async (data) => {\n        errorHandled = false;  \n        if (!data.docs[0]?.items || !Array.isArray(data.docs[0].items)) {\n            console.error(\"Invalid or missing items array\", data.docs[0]?.items);\n            return;\n        }\n       addvalues();\n    },\n    onError(error) {\n        createToast({\n            title: 'error',\n            message: Array.isArray(error?.messages) ? error.messages[0] : error?.messages || 'An error occurred',\n            icon: 'x-circle',\n            iconClasses: 'bg-surface-red-5 text-ink-white rounded-md p-px',\n            position: 'top-center',\n            timeout: 5,\n        });\n        errorHandled = true;\n    }\n});\nconst  addvalues = async ()=>{\n    base.invoice =  { ...salesInvoice.data.docs[0], status: null  }\n    base.is_return =salesInvoice.data.docs[0].is_return\n    base.items = salesInvoice.data.docs[0].items;\n    base.discount_amount =  salesInvoice.data.docs[0].discount_amount;\n    base.additional_discount_percentage =  salesInvoice.data.docs[0].additional_discount_percentage;\n    base.total =  salesInvoice.data.docs[0].net_total;\n    await get_value.fetch({\n        doctype: \"Customer\",\n        filters: { \"name\": salesInvoice.data.docs[0].customer },\n        fieldname: ['name', 'mobile_no', 'customer_group', 'territory', 'is_internal_customer'],\n    });\n    base.customer = get_value.data || {};\n    searchQuery.value=''\n    handleDialogClose()\n\n}\n\nlet get_value = createResource({\n        url:'frappe.client.get_value',\n        makeParams(params) {\n        return { ...params }\n        },\n        transform: (data) => {\n            \n                return {\n                label: data.name,\n                value: data.name,\n                mobile_no: data.mobile_no,\n                name: data.name,\n                customer_group: data.customer_group,\n                territory: data.territory,\n                is_internal_customer: data.is_internal_customer,\n                }\n    },\n    onError(error) {\n            createToast({\n                title: 'error',\n                message: Array.isArray(error?.messages) ? error.messages[0] : error?.messages || 'An error occurred',\n                icon: 'x-circle',\n                iconClasses: 'bg-surface-red-5 text-ink-white rounded-md p-px',\n                position: 'top-center',\n                timeout: 5,\n            });\n            errorHandled = true;\n        }\n\n})\nconst invoices = createListResource({\n    doctype: 'Sales Invoice',\n    fields: ['name', 'customer', 'grand_total'],\n    orderBy: 'creation desc',\n    filters: { \n        docstatus: 0, \n        pos_profile: \n        base.pos_profile.name, \n    },\n    orFilters: [],\n    pageLength: 20,\n    auto: true\n    });\n\nconst filteredInvoices = computed(() => {\n    if (!searchQuery.value) {\n        return invoices.data;\n    }\n    return invoices.data.filter(invoice =>\n        invoice.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||\n        invoice.customer.toLowerCase().includes(searchQuery.value.toLowerCase())\n    );\n});\n\n\nwatch(searchQuery, (newQuery) => {\n  invoices.update({\n    filters: {\n        docstatus: 0, \n        pos_profile: \n        base.pos_profile.name,\n    },\n    orFilters: newQuery\n      ? [\n          ['name', 'like', `%${newQuery}%`],\n          ['customer', 'like', `%${newQuery}%`]\n        ]\n      : []\n  });\n  invoices.reload();\n});\n</script>"],"names":["base","inject","dialogVisible","ref","selectedInvoice","searchQuery","selectedPageLength","handleDialogClose","setPageLength","size","invoices","submitInvoice","salesInvoice","createResource","params","data","item","serial","_a","_b","addvalues","error","createToast","get_value","createListResource","filteredInvoices","computed","invoice","watch","newQuery","_createBlock","_unref","Dialog","$event","_cache","_createElementVNode","_hoisted_1","_createVNode","TextInput","FeatherIcon","_hoisted_2","_createElementBlock","_Fragment","_renderList","_hoisted_3","_hoisted_4","_hoisted_6","_toDisplayString","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","Button","_hoisted_11"],"mappings":"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"}