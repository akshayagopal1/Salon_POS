import{i as V,r as m,aK as w,aP as L,c as M,w as A,B as $,C as u,D as r,ag as s,E as d,u as a,aq as p,ar as f,az as D,am as j,aj as b,F as S,an as C,ai as z,aU as E,ao as _,aT as N}from"./index-BsfeXoGf.js";import{c as I}from"./Pos-KCdXzYUv.js";const P={class:"w-full h-[60vh] rounded-2xl p-3 shadow-2xl flex flex-col gap-4",style:{"background-color":"#ffffff !important",color:"#82868f !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},T={class:"h-[82%] overflow-y-scroll scrollbar-hide"},q={class:"flex justify-evenly rounded p-2.5 my-2",style:{"background-color":"#f8f8fc !important",color:"#82868f !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},H={class:"w-[10%]"},K=["value"],G={class:"w-[30%]"},J={class:"w-[30%]"},O={class:"w-[30%]"},W={class:"flex justify-between items-center mt-4"},X={class:"flex gap-2"},Y={class:""},te={__name:"Held",setup(Z){let l=V("base");const g=m(!0),y=m(null),c=m(""),v=m(20),x=()=>{g.value=!1},B=e=>{v.value!==e&&(v.value=e,n.update({pageLength:e,start:0}),n.reload())},F=()=>{i.fetch({name:y.value})};let i=w({url:"frappe.desk.form.load.getdoc",makeParams(e){return{doctype:"Sales Invoice",name:e.name}},transform(e){return e.docs[0]&&e.docs[0].items&&e.docs[0].items.length>0&&e.docs[0].items.forEach(t=>{t.serial_no&&(t.selected_serial_no=t.serial_no.trim().split(`
`).map(o=>({label:o,value:o}))),t.batch_no?t.selected_batch_no={label:t.batch_no,value:t.batch_no}:t.selected_batch_no=null,t.custom_id||(t.custom_id=Date.now()+Math.random())}),e},onSuccess:async e=>{var t,o;if(!((t=e.docs[0])!=null&&t.items)||!Array.isArray(e.docs[0].items)){console.error("Invalid or missing items array",(o=e.docs[0])==null?void 0:o.items);return}U()},onError(e){I({title:"error",message:Array.isArray(e==null?void 0:e.messages)?e.messages[0]:(e==null?void 0:e.messages)||"An error occurred",icon:"x-circle",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:5})}});const U=async()=>{l.invoice={...i.data.docs[0],status:null},l.is_return=i.data.docs[0].is_return,l.items=i.data.docs[0].items,l.discount_amount=i.data.docs[0].discount_amount,l.additional_discount_percentage=i.data.docs[0].additional_discount_percentage,l.total=i.data.docs[0].net_total,await k.fetch({doctype:"Customer",filters:{name:i.data.docs[0].customer},fieldname:["name","mobile_no","customer_group","territory","is_internal_customer"]}),l.customer=k.data||{},c.value="",x()};let k=w({url:"frappe.client.get_value",makeParams(e){return{...e}},transform:e=>({label:e.name,value:e.name,mobile_no:e.mobile_no,name:e.name,customer_group:e.customer_group,territory:e.territory,is_internal_customer:e.is_internal_customer}),onError(e){I({title:"error",message:Array.isArray(e==null?void 0:e.messages)?e.messages[0]:(e==null?void 0:e.messages)||"An error occurred",icon:"x-circle",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:5})}});const n=L({doctype:"Sales Invoice",fields:["name","customer","grand_total"],orderBy:"creation desc",filters:{docstatus:0,pos_profile:l.pos_profile.name},orFilters:[],pageLength:20,auto:!0}),R=M(()=>c.value?n.data.filter(e=>e.name.toLowerCase().includes(c.value.toLowerCase())||e.customer.toLowerCase().includes(c.value.toLowerCase())):n.data);return A(c,e=>{n.update({filters:{docstatus:0,pos_profile:l.pos_profile.name},orFilters:e?[["name","like",`%${e}%`],["customer","like",`%${e}%`]]:[]}),n.reload()}),(e,t)=>(u(),$(a(N),{options:{size:"3xl"},modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=o=>g.value=o),class:"rounded-b"},{"body-title":r(()=>[...t[4]||(t[4]=[s("p",{class:"text-3xl",style:{color:"#4e60ac !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},"Select Invoice",-1)])]),"body-content":r(()=>[s("div",P,[d(a(D),{type:"text",modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=o=>c.value=o),placeholder:"Search"},{prefix:r(()=>[d(a(j),{class:"w-4",name:"search"})]),_:1},8,["modelValue"]),t[6]||(t[6]=s("div",{class:"flex justify-evenly rounded-md p-3 h-[8%]",style:{"background-color":"#4e60ac !important",color:"white !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},[s("div",{class:"w-[10%]"}),s("p",{class:"w-[30%]"},"Name"),s("p",{class:"w-[30%]"},"Customer"),s("p",{class:"w-[30%]"},"Amount")],-1)),s("div",T,[(u(!0),b(S,null,C(R.value,o=>(u(),b("div",{key:o.name,class:"flex flex-col"},[s("div",q,[s("div",H,[z(s("input",{type:"radio",name:"selectedInvoice",value:o.name,class:"text-black hover:text-black","onUpdate:modelValue":t[1]||(t[1]=h=>y.value=h)},null,8,K),[[E,y.value]])]),s("p",G,_(o.name),1),s("p",J,_(o.customer),1),s("p",O,_(o.grand_total),1)])]))),128))]),s("div",W,[s("div",X,[(u(),b(S,null,C([20,100,500,2500],o=>d(a(p),{key:o,variant:v.value===o?"solid":"ghost",onClick:h=>B(o),ref_for:!0,loading:a(n).loading,disabled:a(n).loading,link:null,style:{"background-color":"#4e60ac !important","border-color":"#4e60ac !important",color:"white !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},{default:r(()=>[f(_(o),1)]),_:2},1032,["variant","onClick","loading","disabled"])),64))]),d(a(p),{onClick:t[2]||(t[2]=o=>a(n).next()),variant:"solid",loading:a(n).loading,disabled:a(n).loading,style:{"background-color":"#4e60ac !important","border-color":"#4e60ac !important",color:"white !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},{default:r(()=>[...t[5]||(t[5]=[f(" Next ",-1)])]),_:1},8,["loading","disabled"])])])]),actions:r(()=>[s("div",Y,[d(a(p),{variant:"solid",onClick:F,style:{"background-color":"#4e60ac !important","border-color":"#4e60ac !important",color:"white !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},{default:r(()=>[...t[7]||(t[7]=[f("Select",-1)])]),_:1}),d(a(p),{class:"ml-2",onClick:x,style:{"background-color":"#82868f !important","border-color":"#82868f !important",color:"white !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},{default:r(()=>[...t[8]||(t[8]=[f("Close",-1)])]),_:1})])]),_:1},8,["modelValue"]))}};export{te as default};
//# sourceMappingURL=Held-BMNzW_zK.js.map
