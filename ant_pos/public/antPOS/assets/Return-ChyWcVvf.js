import{i as A,r as u,aK as b,aP as L,c as D,w as $,B as j,C as m,D as i,ag as s,E as d,u as a,aq as p,ar as f,az as E,am as N,aj as x,F as C,an as I,ai as P,aU as z,ao as _,aT as T,aC as q}from"./index-BsfeXoGf.js";import{c as h}from"./Pos-KCdXzYUv.js";const K={class:"w-full h-[60vh] rounded-2xl p-3 shadow-2xl flex flex-col gap-4",style:{"background-color":"#ffffff !important",color:"#82868f !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},G={class:"h-[82%] overflow-y-scroll scrollbar-hide"},H={class:"flex justify-evenly rounded p-2.5 my-2",style:{"background-color":"#f8f8fc !important",color:"#82868f !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},J={class:"w-[10%]"},O=["value"],W={class:"w-[30%]"},X={class:"w-[30%]"},Y={class:"w-[30%]"},Z={class:"flex justify-between items-center mt-4"},Q={class:"flex gap-2"},ee={class:""},ae={__name:"Return",setup(te){let l=A("base");const g=u(!0),y=u(null),r=u(""),v=u(20),k=()=>{g.value=!1},B=e=>{v.value!==e&&(v.value=e,n.update({pageLength:e,start:0}),n.reload())},F=()=>{R.fetch({name:y.value})};let c=b({url:"run_doc_method",makeParams(e){return{...e}},transform(e){return e.docs[0]&&e.docs[0].items&&e.docs[0].items.length>0&&e.docs[0].items.forEach(t=>{t.serial_no&&(t.selected_serial_no=t.serial_no.trim().split(`
`).map(o=>({label:o,value:o}))),t.serial_no&&(t._serial=t.serial_no.trim().split(`
`)),t.batch_no?t.selected_batch_no={label:t.batch_no,value:t.batch_no}:t.selected_batch_no=null,t.custom_id||(t.custom_id=Date.now()+Math.random())}),e},onSuccess(e){M()},onError(e){h({title:"error",message:Array.isArray(e==null?void 0:e.messages)?e.messages[0]:(e==null?void 0:e.messages)||"An error occurred",icon:"x-circle",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:5})}}),R=b({url:"frappe.model.mapper.make_mapped_doc",makeParams(e){return{method:"erpnext.accounts.doctype.sales_invoice.sales_invoice.make_sales_return",source_name:e.name,selected_children:{},args:""}},onSuccess:async e=>{await c.fetch({for_validate:!0,docs:e,method:"set_missing_values",args:{for_validate:!0}})},onError(e){h({title:"error",message:Array.isArray(e==null?void 0:e.messages)?e.messages[0]:(e==null?void 0:e.messages)||"An error occurred",icon:"x-circle",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:5})}});const n=L({doctype:"Sales Invoice",fields:["name","customer","grand_total"],orderBy:"creation desc",filters:{docstatus:1,pos_profile:l.pos_profile.name,is_return:0,status:["!=","Credit Note Issued"]},orFilters:[],pageLength:20,auto:!0}),U=D(()=>r.value?(n.data||[]).filter(e=>e.name.toLowerCase().includes(r.value.toLowerCase())||e.customer.toLowerCase().includes(r.value.toLowerCase())):n.data||[]),M=async()=>{l.invoice={...c.data.docs[0],status:null,name:"new-sales-invoice-jpodtuhocv"},l.items=c.data.docs[0].items||[],l.discount_amount=c.data.docs[0].discount_amount,l.additional_discount_percentage=c.data.docs[0].additional_discount_percentage,l.total=c.data.docs[0].net_total,await w.fetch({doctype:"Customer",filters:{name:c.data.docs[0].customer},fieldname:["name","mobile_no","customer_group","territory","is_internal_customer"]}),l.customer=w.data||{},r.value="",l.is_return=1,k()};let w=b({url:"frappe.client.get_value",makeParams(e){return{...e}},transform:e=>({label:e.name,value:e.name,mobile_no:e.mobile_no,name:e.name,customer_group:e.customer_group,territory:e.territory,is_internal_customer:e.is_internal_customer}),onError(e){h({title:"error",message:Array.isArray(e==null?void 0:e.messages)?e.messages[0]:(e==null?void 0:e.messages)||"An error occurred",icon:"x-circle",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:5})}});const V=q(e=>{n.update({filters:{docstatus:1,pos_profile:l.pos_profile.name,is_return:0},orFilters:e?[["name","like",`%${e}%`],["customer","like",`%${e}%`]]:[]}),n.reload()},300);return $(r,V),(e,t)=>(m(),j(a(T),{options:{size:"3xl"},modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=o=>g.value=o),class:"rounded-b"},{"body-title":i(()=>[...t[4]||(t[4]=[s("p",{class:"text-3xl",style:{color:"#4e60ac !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},"Select Invoice",-1)])]),"body-content":i(()=>[s("div",K,[d(a(E),{type:"text",modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=o=>r.value=o),placeholder:"Search"},{prefix:i(()=>[d(a(N),{class:"w-4",name:"search"})]),_:1},8,["modelValue"]),t[6]||(t[6]=s("div",{class:"flex justify-evenly rounded-md p-3 h-[8%]",style:{"background-color":"#4e60ac !important",color:"white !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},[s("div",{class:"w-[10%]"}),s("p",{class:"w-[30%]"},"Name"),s("p",{class:"w-[30%]"},"Customer"),s("p",{class:"w-[30%]"},"Amount")],-1)),s("div",G,[(m(!0),x(C,null,I(U.value,o=>(m(),x("div",{key:o.name,class:"flex flex-col"},[s("div",H,[s("div",J,[P(s("input",{type:"radio",name:"selectedInvoice",value:o.name,class:"text-black hover:text-black","onUpdate:modelValue":t[1]||(t[1]=S=>y.value=S)},null,8,O),[[z,y.value]])]),s("p",W,_(o.name),1),s("p",X,_(o.customer),1),s("p",Y,_(o.grand_total),1)])]))),128))]),s("div",Z,[s("div",Q,[(m(),x(C,null,I([20,100,500,2500],o=>d(a(p),{key:o,variant:v.value===o?"solid":"ghost",onClick:S=>B(o),ref_for:!0,loading:a(n).loading,disabled:a(n).loading,link:null,style:{"background-color":"#4e60ac !important","border-color":"#4e60ac !important",color:"white !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},{default:i(()=>[f(_(o),1)]),_:2},1032,["variant","onClick","loading","disabled"])),64))]),d(a(p),{onClick:t[2]||(t[2]=o=>a(n).next()),variant:"solid",loading:a(n).loading,disabled:a(n).loading,style:{"background-color":"#4e60ac !important","border-color":"#4e60ac !important",color:"white !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},{default:i(()=>[...t[5]||(t[5]=[f(" Next ",-1)])]),_:1},8,["loading","disabled"])])])]),actions:i(()=>[s("div",ee,[d(a(p),{variant:"solid",onClick:F,style:{"background-color":"#4e60ac !important","border-color":"#4e60ac !important",color:"white !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},{default:i(()=>[...t[7]||(t[7]=[f("Select",-1)])]),_:1}),d(a(p),{class:"ml-2",onClick:k,style:{"background-color":"#82868f !important","border-color":"#82868f !important",color:"white !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},{default:i(()=>[...t[8]||(t[8]=[f("Close",-1)])]),_:1})])]),_:1},8,["modelValue"]))}};export{ae as default};
//# sourceMappingURL=Return-ChyWcVvf.js.map
