import{D as j,r as u,b3 as h,b6 as B,c as E,w as P,U as R,R as m,$ as i,S as t,Z as r,u as o,ac as _,ae as p,aV as F,a8 as U,Q as x,F as V,a9 as A,a0 as M,bb as T,aa as f,ba as Y,aY as Z}from"./index-W9TX4JPH.js";import{c as y}from"./Pos-DZFo8QfI.js";const q={class:"w-full h-[60vh] bg-white-overlay-100 rounded-2xl p-3 shadow-2xl flex flex-col gap-4"},G={class:"h-[82%] overflow-y-scroll scrollbar-hide"},H={class:"flex justify-evenly rounded bg-blue-200 p-2.5 my-2"},J={class:"w-[10%]"},K=["value"],O={class:"w-[30%]"},Q={class:"w-[30%]"},W={class:"w-[30%]"},X={class:"flex justify-between items-center mt-4"},z={class:"flex gap-2"},ee={class:""},oe={__name:"Return",setup(se){let n=j("base");const v=u(!0),g=u(null),c=u(""),b=u(20),w=()=>{v.value=!1},L=e=>{b.value!==e&&(b.value=e,l.update({pageLength:e,start:0}),l.reload())},I=()=>{$.fetch({name:g.value})};let d=h({url:"run_doc_method",makeParams(e){return{...e}},transform(e){return e.docs[0]&&e.docs[0].items&&e.docs[0].items.length>0&&e.docs[0].items.forEach(s=>{s.serial_no&&(s.selected_serial_no=s.serial_no.trim().split(`
`).map(a=>({label:a,value:a}))),s.serial_no&&(s._serial=s.serial_no.trim().split(`
`)),s.batch_no?s.selected_batch_no={label:s.batch_no,value:s.batch_no}:s.selected_batch_no=null,s.custom_id||(s.custom_id=Date.now()+Math.random())}),e},onSuccess(e){D()},onError(e){y({title:"error",message:Array.isArray(e==null?void 0:e.messages)?e.messages[0]:(e==null?void 0:e.messages)||"An error occurred",icon:"x-circle",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:5})}}),$=h({url:"frappe.model.mapper.make_mapped_doc",makeParams(e){return{method:"erpnext.accounts.doctype.sales_invoice.sales_invoice.make_sales_return",source_name:e.name,selected_children:{},args:""}},onSuccess:async e=>{await d.fetch({for_validate:!0,docs:e,method:"set_missing_values",args:{for_validate:!0}})},onError(e){y({title:"error",message:Array.isArray(e==null?void 0:e.messages)?e.messages[0]:(e==null?void 0:e.messages)||"An error occurred",icon:"x-circle",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:5})}});const l=B({doctype:"Sales Invoice",fields:["name","customer","grand_total"],orderBy:"creation desc",filters:{docstatus:1,pos_profile:n.pos_profile.name,is_return:0,status:["!=","Credit Note Issued"]},orFilters:[],pageLength:20,auto:!0}),S=E(()=>c.value?(l.data||[]).filter(e=>e.name.toLowerCase().includes(c.value.toLowerCase())||e.customer.toLowerCase().includes(c.value.toLowerCase())):l.data||[]),D=async()=>{n.invoice={...d.data.docs[0],status:null,name:"new-sales-invoice-jpodtuhocv"},n.items=d.data.docs[0].items||[],n.discount_amount=d.data.docs[0].discount_amount,n.additional_discount_percentage=d.data.docs[0].additional_discount_percentage,n.total=d.data.docs[0].net_total,await k.fetch({doctype:"Customer",filters:{name:d.data.docs[0].customer},fieldname:["name","mobile_no","customer_group","territory","is_internal_customer"]}),n.customer=k.data||{},c.value="",n.is_return=1,w()};let k=h({url:"frappe.client.get_value",makeParams(e){return{...e}},transform:e=>({label:e.name,value:e.name,mobile_no:e.mobile_no,name:e.name,customer_group:e.customer_group,territory:e.territory,is_internal_customer:e.is_internal_customer}),onError(e){y({title:"error",message:Array.isArray(e==null?void 0:e.messages)?e.messages[0]:(e==null?void 0:e.messages)||"An error occurred",icon:"x-circle",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:5})}});const N=Z(e=>{l.update({filters:{docstatus:1,pos_profile:n.pos_profile.name,is_return:0},orFilters:e?[["name","like",`%${e}%`],["customer","like",`%${e}%`]]:[]}),l.reload()},300);return P(c,N),(e,s)=>(m(),R(o(Y),{options:{size:"3xl"},modelValue:v.value,"onUpdate:modelValue":s[3]||(s[3]=a=>v.value=a),class:"rounded-b"},{"body-title":i(()=>s[4]||(s[4]=[t("p",{class:"text-3xl"},"Select Invoice",-1)])),"body-content":i(()=>[t("div",q,[r(o(F),{type:"text",modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=a=>c.value=a),placeholder:"Search"},{prefix:i(()=>[r(o(U),{class:"w-4",name:"search"})]),_:1},8,["modelValue"]),s[6]||(s[6]=t("div",{class:"flex justify-evenly bg-black-overlay-800 text-white rounded-md p-3 h-[8%]"},[t("div",{class:"w-[10%]"}),t("p",{class:"w-[30%]"},"Name"),t("p",{class:"w-[30%]"},"Customer"),t("p",{class:"w-[30%]"},"Amount")],-1)),t("div",G,[(m(!0),x(V,null,A(S.value,a=>(m(),x("div",{key:a.name,class:"flex flex-col"},[t("div",H,[t("div",J,[M(t("input",{type:"radio",name:"selectedInvoice",value:a.name,class:"text-black hover:text-black","onUpdate:modelValue":s[1]||(s[1]=C=>g.value=C)},null,8,K),[[T,g.value]])]),t("p",O,f(a.name),1),t("p",Q,f(a.customer),1),t("p",W,f(a.grand_total),1)])]))),128))]),t("div",X,[t("div",z,[(m(),x(V,null,A([20,100,500,2500],a=>r(o(_),{key:a,variant:b.value===a?"solid":"ghost",onClick:C=>L(a),ref_for:!0,loading:o(l).loading,disabled:o(l).loading,link:null},{default:i(()=>[p(f(a),1)]),_:2},1032,["variant","onClick","loading","disabled"])),64))]),r(o(_),{onClick:s[2]||(s[2]=a=>o(l).next()),variant:"solid",loading:o(l).loading,disabled:o(l).loading},{default:i(()=>s[5]||(s[5]=[p(" Next ",-1)])),_:1,__:[5]},8,["loading","disabled"])])])]),actions:i(()=>[t("div",ee,[r(o(_),{variant:"solid",onClick:I},{default:i(()=>s[7]||(s[7]=[p("Select",-1)])),_:1,__:[7]}),r(o(_),{class:"ml-2",onClick:w},{default:i(()=>s[8]||(s[8]=[p("Close",-1)])),_:1,__:[8]})])]),_:1},8,["modelValue"]))}};export{oe as default};
//# sourceMappingURL=Return-BKxkI4r_.js.map
