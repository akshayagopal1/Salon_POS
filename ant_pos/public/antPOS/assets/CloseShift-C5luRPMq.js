import{av as j,aj as b,C as u,ag as t,r as _,i as D,aK as V,w as E,B as M,D as y,ak as R,u as s,E as c,F as P,an as L,ao as d,aC as q,aq as C,ar as w,aT as G}from"./index-BSAhIZmI.js";import{u as H,c as J,_ as g}from"./Pos-BCPVCKkp.js";const K={},Q={class:"spinner",viewBox:"0 0 50 50"};function W(A,m){return u(),b("svg",Q,[...m[0]||(m[0]=[t("defs",null,[t("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[t("stop",{offset:"0%","stop-color":"rgba(0,110,219,1)"}),t("stop",{offset:"100%","stop-color":"rgba(255,255,255,0)"})])],-1),t("circle",{stroke:"url(#gradient)",class:"spinner-path",cx:"25",cy:"25",r:"20",fill:"none","stroke-width":"5"},null,-1)])])}const X=j(K,[["render",W],["__scopeId","data-v-5c03f65e"]]),Y={style:{"background-color":"#ffffff !important",color:"#82868f !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},Z={key:0,class:"w-full flex justify-center mb-2"},ee={class:"w-full mt-2"},te={class:"py-2 pr-4 w-48"},oe={class:"py-2 px-1"},ne={class:"py-2 px-1"},se={class:"py-2 px-1"},ae={class:"py-2 px-1"},le={class:"font-bold border-t"},ie={class:"py-2 px-1"},ce={class:"py-2 px-1"},pe={class:"py-2 px-1"},re={class:"py-2 px-1"},de={class:"flex justify-end gap-2 mt-4"},fe={__name:"CloseShift",emits:["switchComponent"],setup(A,{emit:m}){const f=_(!0),a=D("base"),N=_(!1),i=_(a.pos_profile.payments);let h=!1;const{currentComponent:U,loadComponent:B}=H(),r=_({opening:0,closing:0,expected:0,difference:0}),O=q(o=>{const e=i.value[o];e&&(e.difference=(e.expected||0)-(e.closing||0),v())},100);let z=V({url:"ant_pos.ant_pos.api.payment_entry.get_payments",method:"POST",makeParams(){var o;return{shift:(o=a==null?void 0:a.Ant_Opening_Shift)==null?void 0:o.name}},auto:!0,onSuccess(o){I(o)}});const T=m,I=o=>{const e=[];a.pos_profile.payments.forEach(n=>{const p=a.Ant_Opening_Shift.opening_balance_details.find(S=>S.mode_of_payment===n.mode_of_payment),l=o.find(S=>S.mode_of_payment===n.mode_of_payment),x=Number(p==null?void 0:p.opening_amount)||0,k=Number(l==null?void 0:l.total)||0;e.push({mode_of_payment:n.mode_of_payment,opening:x,expected:k+x,closing:k+x,difference:0})}),i.value=e,v()},F=async()=>{f.value=!1,N.value=!0,await B("OpenShift")},$=V({url:"frappe.desk.form.save.savedocs",makeParams(o){var e;return{doc:JSON.stringify({doctype:"Ant Closing Shift",payment_reconciliation:i.value,ant_opening_shift:(e=a==null?void 0:a.Ant_Opening_Shift)==null?void 0:e.name}),action:o.action}},async onSuccess(o){h=!1,Object.assign(a,{customer:{},Ant_Opening_Shift:{},items:[],invoice:{},page:""}),f.value=!1,setTimeout(()=>{U.value=null,T("switchComponent","OpenShift")},100)},onError(o){h||(J({title:"error",message:Array.isArray(o==null?void 0:o.messages)?o.messages[0]:(o==null?void 0:o.messages)||"An error occurred",icon:"x-circle",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:5}),h=!0)}}),v=()=>{r.value={opening:i.value.reduce((o,e)=>o+(Number(e.opening)||0),0),closing:i.value.reduce((o,e)=>o+(Number(e.closing)||0),0),expected:i.value.reduce((o,e)=>o+(Number(e.expected)||0),0),difference:i.value.reduce((o,e)=>o+(Number(e.difference)||0),0)}};return E(i,v,{deep:!0}),(o,e)=>(u(),M(s(G),{options:{size:"3xl"},modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=n=>f.value=n)},{"body-title":y(()=>[...e[2]||(e[2]=[t("h3",{style:{color:"#4e60ac !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},"ANT Closing Shift",-1)])]),"body-content":y(()=>[t("div",Y,[s(z).isLoading?(u(),b("div",Z,[c(s(X),{class:"w-5 h-5"})])):R("",!0),t("table",ee,[e[4]||(e[4]=t("thead",null,[t("tr",{class:"text-left text-sm border-b",style:{"background-color":"#4e60ac !important",color:"white !important","font-weight":"600 !important"}},[t("th",{class:"pb-2 w-48"},"Mode of Payment"),t("th",{class:"pb-2 w-32"},"Opening Amount"),t("th",{class:"pb-2 w-32"},"Closing Amount"),t("th",{class:"pb-2 w-32"},"Expected Amount"),t("th",{class:"pb-2 w-32"},"Difference")])],-1)),t("tbody",null,[(u(!0),b(P,null,L(i.value,(n,p)=>(u(),b("tr",{key:p,class:"border-b"},[t("td",te,d(n.mode_of_payment),1),t("td",oe,[c(s(g),{type:"number",size:"sm",variant:"subtle",disabled:"true",modelValue:n.opening,"onUpdate:modelValue":l=>n.opening=l},null,8,["modelValue","onUpdate:modelValue"])]),t("td",ne,[c(s(g),{type:"text",inputmode:"decimal",step:"any",size:"sm",variant:"subtle",modelValue:n.closing,"onUpdate:modelValue":l=>n.closing=l,onInput:l=>s(O)(p)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),t("td",se,[c(s(g),{type:"number",size:"sm",variant:"subtle",disabled:"true",modelValue:n.expected,"onUpdate:modelValue":l=>n.expected=l},null,8,["modelValue","onUpdate:modelValue"])]),t("td",ae,[c(s(g),{type:"number",size:"sm",variant:"subtle",disabled:"true",value:n.difference},null,8,["value"])])]))),128))]),t("tfoot",null,[t("tr",le,[e[3]||(e[3]=t("td",{class:"py-2 pr-4"},"Total",-1)),t("td",ie,d(r.value.opening),1),t("td",ce,d(r.value.closing),1),t("td",pe,d(r.value.expected),1),t("td",re,d(r.value.difference),1)])])]),t("div",de,[c(s(C),{variant:"ghost",onClick:F,style:{"background-color":"#7c8bca !important","border-color":"#7c8bca !important",color:"white !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},{default:y(()=>[...e[5]||(e[5]=[w("Cancel",-1)])]),_:1}),c(s(C),{variant:"solid",onClick:e[0]||(e[0]=n=>s($).fetch({action:"Submit"})),style:{"background-color":"#4e60ac !important","border-color":"#4e60ac !important",color:"white !important","font-family":"'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important","font-size":"17px !important"}},{default:y(()=>[...e[6]||(e[6]=[w("Submit",-1)])]),_:1})])])]),_:1},8,["modelValue"]))}};export{fe as default};
//# sourceMappingURL=CloseShift-C5luRPMq.js.map
