{"version":3,"file":"Attendance-WY7T6c_y.js","sources":["../../../../AntPos/src/components/Dialog/Attendance.vue"],"sourcesContent":["<template>\r\n  <Dialog :options=\"{ size: 'lg' }\" v-model=\"dialogVisible\">\r\n    <template #body-title>\r\n      <h3 class=\"text-[#4e60ac]\" style=\"font-family: 'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 17px;\">Mark Attendance</h3>\r\n    </template>\r\n\r\n    <template #body-content>\r\n      <div class=\"bg-[#ffffff] text-[#82868f]\" style=\"font-family: 'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 17px;\">\r\n      <div class=\"space-y-3\">\r\n        <!-- Employee Dropdown -->\r\n        <FormControl\r\n          type=\"autocomplete\"\r\n          :options=\"options.employees\"\r\n          size=\"sm\"\r\n          variant=\"subtle\"\r\n          placeholder=\"Select Employee\"\r\n          label=\"Employee\"\r\n          v-model=\"formData.employee\"\r\n        />\r\n\r\n        <!-- Status -->\r\n        <FormControl\r\n          type=\"autocomplete\"\r\n          :options=\"statusOptions\"\r\n          size=\"sm\"\r\n          variant=\"subtle\"\r\n          placeholder=\"Select Status\"\r\n          label=\"Status\"\r\n          v-model=\"formData.status\"\r\n        />\r\n\r\n        <!-- Date -->\r\n        <FormControl\r\n          type=\"date\"\r\n          size=\"sm\"\r\n          variant=\"subtle\"\r\n          label=\"Date\"\r\n          v-model=\"formData.date\"\r\n        />\r\n\r\n        <!-- Company -->\r\n        <FormControl\r\n          type=\"autocomplete\"\r\n          :options=\"options.companies\"\r\n          size=\"sm\"\r\n          variant=\"subtle\"\r\n          placeholder=\"Select Company\"\r\n          label=\"Company\"\r\n          v-model=\"formData.company\"\r\n        />\r\n\r\n        <!-- Shift -->\r\n        <FormControl\r\n          type=\"autocomplete\"\r\n          :options=\"options.shifts\"\r\n          size=\"sm\"\r\n          variant=\"subtle\"\r\n          placeholder=\"Select Shift (Optional)\"\r\n          label=\"Shift\"\r\n          v-model=\"formData.shift\"\r\n        />\r\n\r\n        <!-- Late Entry -->\r\n        <FormControl label=\"Late Entry (minutes)\">\r\n          <Input\r\n            type=\"number\"\r\n            min=\"0\"\r\n            v-model.number=\"formData.late_entry\"\r\n          />\r\n        </FormControl>\r\n\r\n        <!-- Early Exit -->\r\n        <FormControl label=\"Early Exit (minutes)\">\r\n          <Input\r\n            type=\"number\"\r\n            min=\"0\"\r\n            v-model.number=\"formData.early_exit\"\r\n          />\r\n        </FormControl>\r\n      </div>\r\n      \r\n      <div class=\"flex justify-end gap-2 mt-4\">\r\n        <Button variant=\"ghost\" @click=\"closeDialog\">Cancel</Button>\r\n        <Button variant=\"solid\" @click=\"handleSubmit\" style=\"background-color: #4e60ac !important; border-color: #4e60ac !important; color: white !important; font-family: 'futura-pt', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; font-size: 17px !important;\">Submit</Button>\r\n      </div>\r\n      </div>\r\n    </template>\r\n  </Dialog>\r\n</template>\r\n\r\n<script setup>\r\nimport { createResource, Button, Dialog, FormControl } from 'frappe-ui';\r\nimport { inject, ref, reactive, onMounted } from 'vue';\r\n\r\nconst dialogVisible = ref(true);\r\nconst options = reactive({\r\n  employees: [],\r\n  companies: [],\r\n  shifts: []\r\n});\r\n\r\nconst formData = ref({\r\n  employee: {},\r\n  status: { label: 'Present', value: 'Present' },\r\n  date: new Date().toISOString().slice(0, 10),\r\n  company: {},\r\n  shift: {},\r\n  late_entry: 0,\r\n  early_exit: 0\r\n});\r\n\r\nconst statusOptions = [\r\n  { label: 'Present', value: 'Present' },\r\n  { label: 'Absent', value: 'Absent' },\r\n  { label: 'Half Day', value: 'Half Day' },\r\n  { label: 'On Leave', value: 'On Leave' },\r\n  { label: 'Work From Home', value: 'Work From Home' }\r\n];\r\n\r\nfunction closeDialog() {\r\n  dialogVisible.value = false;\r\n}\r\n\r\n// Fetch dropdown data using POS profile pattern\r\nconst fetchDropdownData = createResource({\r\n  url: 'ant_pos.ant_pos.api.attendance.get_dropdown_data',\r\n  method: 'GET',\r\n  onSuccess(data) {\r\n    console.log('Dropdown data loaded:', data);\r\n    if (data) {\r\n      options.employees = data.employees?.map(emp => ({ \r\n        label: emp.employee_name, \r\n        value: emp.name \r\n      })) || [];\r\n      options.companies = data.companies?.map(comp => ({ \r\n        label: comp.name, \r\n        value: comp.name \r\n      })) || [];\r\n      options.shifts = data.shifts?.map(shift => ({ \r\n        label: shift.name, \r\n        value: shift.name \r\n      })) || [];\r\n    }\r\n  },\r\n  onError(error) {\r\n    console.error('Failed to load dropdown data:', error);\r\n  }\r\n});\r\n\r\n// Create attendance submission resource\r\nconst createAttendance = createResource({\r\n  url: 'ant_pos.ant_pos.api.attendance.create_attendance',\r\n  onSuccess(data) {\r\n    alert(`Attendance marked successfully! Document: ${data}`);\r\n    closeDialog();\r\n  },\r\n  onError(err) {\r\n    console.error('Attendance submission failed:', err);\r\n    alert(`Failed to mark attendance: ${err.message}`);\r\n  },\r\n});\r\n\r\n// Submit Attendance\r\nfunction handleSubmit() {\r\n  console.log('Form data before submission:', formData.value);\r\n  \r\n  if (!formData.value.employee?.value || !formData.value.status?.value || !formData.value.date) {\r\n    alert('Please fill all required fields.');\r\n    return;\r\n  }\r\n\r\n  const submissionData = {\r\n    employee: formData.value.employee.value,\r\n    status: formData.value.status.value,\r\n    attendance_date: formData.value.date,\r\n    shift: formData.value.shift?.value || null,\r\n    late_entry: formData.value.late_entry || 0,\r\n    early_exit: formData.value.early_exit || 0\r\n  };\r\n\r\n  console.log('Submission data:', submissionData);\r\n  createAttendance.submit({ values: submissionData });\r\n}\r\n\r\n// Load data on mount\r\nonMounted(() => {\r\n  fetchDropdownData.fetch();\r\n});\r\n</script>\r\n"],"names":["dialogVisible","ref","options","reactive","formData","statusOptions","closeDialog","fetchDropdownData","createResource","data","_a","emp","_b","comp","_c","shift","error","createAttendance","err","handleSubmit","submissionData","onMounted","_createBlock","_unref","Dialog","$event","_cache","_createElementVNode","_hoisted_1","_hoisted_2","_createVNode","FormControl","_component_Input","_hoisted_3","Button"],"mappings":"qbA8FA,MAAMA,EAAgBC,EAAI,EAAI,EACxBC,EAAUC,EAAS,CACvB,UAAW,CAAA,EACX,UAAW,CAAA,EACX,OAAQ,CAAA,CACV,CAAC,EAEKC,EAAWH,EAAI,CACnB,SAAU,CAAA,EACV,OAAQ,CAAE,MAAO,UAAW,MAAO,SAAS,EAC5C,KAAM,IAAI,OAAO,YAAW,EAAG,MAAM,EAAG,EAAE,EAC1C,QAAS,CAAA,EACT,MAAO,CAAA,EACP,WAAY,EACZ,WAAY,CACd,CAAC,EAEKI,EAAgB,CACpB,CAAE,MAAO,UAAW,MAAO,SAAS,EACpC,CAAE,MAAO,SAAU,MAAO,QAAQ,EAClC,CAAE,MAAO,WAAY,MAAO,UAAU,EACtC,CAAE,MAAO,WAAY,MAAO,UAAU,EACtC,CAAE,MAAO,iBAAkB,MAAO,gBAAgB,CACpD,EAEA,SAASC,GAAc,CACrBN,EAAc,MAAQ,EACxB,CAGA,MAAMO,EAAoBC,EAAe,CACvC,IAAK,mDACL,OAAQ,MACR,UAAUC,EAAM,WACd,QAAQ,IAAI,wBAAyBA,CAAI,EACrCA,IACFP,EAAQ,YAAYQ,EAAAD,EAAK,YAAL,YAAAC,EAAgB,IAAIC,IAAQ,CAC9C,MAAOA,EAAI,cACX,MAAOA,EAAI,IACnB,MAAa,CAAA,EACPT,EAAQ,YAAYU,EAAAH,EAAK,YAAL,YAAAG,EAAgB,IAAIC,IAAS,CAC/C,MAAOA,EAAK,KACZ,MAAOA,EAAK,IACpB,MAAa,CAAA,EACPX,EAAQ,SAASY,EAAAL,EAAK,SAAL,YAAAK,EAAa,IAAIC,IAAU,CAC1C,MAAOA,EAAM,KACb,MAAOA,EAAM,IACrB,MAAa,CAAA,EAEX,EACA,QAAQC,EAAO,CACb,QAAQ,MAAM,gCAAiCA,CAAK,CACtD,CACF,CAAC,EAGKC,EAAmBT,EAAe,CACtC,IAAK,mDACL,UAAUC,EAAM,CACd,MAAM,6CAA6CA,CAAI,EAAE,EACzDH,GACF,EACA,QAAQY,EAAK,CACX,QAAQ,MAAM,gCAAiCA,CAAG,EAClD,MAAM,8BAA8BA,EAAI,OAAO,EAAE,CACnD,CACF,CAAC,EAGD,SAASC,GAAe,WAGtB,GAFA,QAAQ,IAAI,+BAAgCf,EAAS,KAAK,EAEtD,GAACM,EAAAN,EAAS,MAAM,WAAf,MAAAM,EAAyB,QAAS,GAACE,EAAAR,EAAS,MAAM,SAAf,MAAAQ,EAAuB,QAAS,CAACR,EAAS,MAAM,KAAM,CAC5F,MAAM,kCAAkC,EACxC,MACF,CAEA,MAAMgB,EAAiB,CACrB,SAAUhB,EAAS,MAAM,SAAS,MAClC,OAAQA,EAAS,MAAM,OAAO,MAC9B,gBAAiBA,EAAS,MAAM,KAChC,QAAOU,EAAAV,EAAS,MAAM,QAAf,YAAAU,EAAsB,QAAS,KACtC,WAAYV,EAAS,MAAM,YAAc,EACzC,WAAYA,EAAS,MAAM,YAAc,CAC7C,EAEE,QAAQ,IAAI,mBAAoBgB,CAAc,EAC9CH,EAAiB,OAAO,CAAE,OAAQG,CAAc,CAAE,CACpD,CAGA,OAAAC,EAAU,IAAM,CACdd,EAAkB,MAAK,CACzB,CAAC,wCA1LCe,EAsFSC,EAAAC,CAAA,EAAA,CAtFA,QAAS,CAAA,KAAA,IAAA,aAAyBxB,EAAA,2CAAAA,EAAa,MAAAyB,KAC3C,eACT,IAAqK,CAAA,GAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAArKC,EAAqK,KAAA,CAAjK,MAAM,iBAAiB,MAAA,CAAA,cAAA,iFAAA,YAAA,MAAA,GAAsH,kBAAe,EAAA,MAGvJ,iBACT,IA8EM,CA9ENA,EA8EM,MA9ENC,EA8EM,CA7END,EAuEM,MAvENE,EAuEM,CArEJC,EAQEP,EAAAQ,CAAA,EAAA,CAPA,KAAK,eACJ,QAAS7B,EAAQ,UAClB,KAAK,KACL,QAAQ,SACR,YAAY,kBACZ,MAAM,WACG,WAAAE,EAAA,MAAS,SAAT,sBAAAsB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAD,GAAArB,EAAA,MAAS,SAAQqB,qCAI5BK,EAQEP,EAAAQ,CAAA,EAAA,CAPA,KAAK,eACJ,QAAS1B,EACV,KAAK,KACL,QAAQ,SACR,YAAY,gBACZ,MAAM,SACG,WAAAD,EAAA,MAAS,OAAT,sBAAAsB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAD,GAAArB,EAAA,MAAS,OAAMqB,2BAI1BK,EAMEP,EAAAQ,CAAA,EAAA,CALA,KAAK,OACL,KAAK,KACL,QAAQ,SACR,MAAM,OACG,WAAA3B,EAAA,MAAS,KAAT,sBAAAsB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAD,GAAArB,EAAA,MAAS,KAAIqB,2BAIxBK,EAQEP,EAAAQ,CAAA,EAAA,CAPA,KAAK,eACJ,QAAS7B,EAAQ,UAClB,KAAK,KACL,QAAQ,SACR,YAAY,iBACZ,MAAM,UACG,WAAAE,EAAA,MAAS,QAAT,sBAAAsB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAD,GAAArB,EAAA,MAAS,QAAOqB,qCAI3BK,EAQEP,EAAAQ,CAAA,EAAA,CAPA,KAAK,eACJ,QAAS7B,EAAQ,OAClB,KAAK,KACL,QAAQ,SACR,YAAY,0BACZ,MAAM,QACG,WAAAE,EAAA,MAAS,MAAT,sBAAAsB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAD,GAAArB,EAAA,MAAS,MAAKqB,qCAIzBK,EAMcP,EAAAQ,CAAA,EAAA,CAND,MAAM,sBAAsB,EAAA,WACvC,IAIE,CAJFD,EAIEE,EAAA,CAHA,KAAK,SACL,IAAI,IACY,WAAA5B,EAAA,MAAS,WAAT,sBAAAsB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAD,GAAArB,EAAA,MAAS,WAAUqB,kBAAnC,CAAA,OAAA,EAAA,kCAKJK,EAMcP,EAAAQ,CAAA,EAAA,CAND,MAAM,sBAAsB,EAAA,WACvC,IAIE,CAJFD,EAIEE,EAAA,CAHA,KAAK,SACL,IAAI,IACY,WAAA5B,EAAA,MAAS,WAAT,sBAAAsB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAD,GAAArB,EAAA,MAAS,WAAUqB,kBAAnC,CAAA,OAAA,EAAA,oCAKNE,EAGM,MAHNM,EAGM,CAFJH,EAA4DP,EAAAW,CAAA,EAAA,CAApD,QAAQ,QAAS,QAAO5B,cAAa,IAAM,CAAA,GAAAoB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAAN,SAAM,EAAA,YACnDI,EAA0SP,EAAAW,CAAA,EAAA,CAAlS,QAAQ,QAAS,QAAOf,EAAc,MAAA,CAAA,mBAAA,qBAAA,eAAA,qBAAA,MAAA,mBAAA,cAAA,4FAAA,YAAA,iBAAA,cAA6O,IAAM,CAAA,GAAAO,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,GAAN,SAAM,EAAA"}