{"version":3,"file":"Return-BKxkI4r_.js","sources":["../../../../AntPos/src/component/Dialog/Return.vue"],"sourcesContent":["<template>\n    <Dialog :options=\"{ size: '3xl' }\" v-model=\"dialogVisible\" class=\"rounded-b\">\n        <template #body-title>\n            <p class=\"text-3xl\">Select Invoice</p>\n        </template>\n        <template #body-content>\n            <div class=\"w-full h-[60vh] bg-white-overlay-100 rounded-2xl p-3 shadow-2xl flex flex-col gap-4\">\n                <TextInput type=\"text\" v-model=\"searchQuery\" placeholder=\"Search\">\n                    <template #prefix>\n                        <FeatherIcon class=\"w-4\" name=\"search\" />\n                    </template>\n                </TextInput>\n                <div class=\"flex justify-evenly bg-black-overlay-800 text-white rounded-md p-3 h-[8%]\">\n                    <div class=\"w-[10%]\"></div>\n                    <p class=\"w-[30%]\">Name</p>\n                    <p class=\"w-[30%]\">Customer</p>\n                    <p class=\"w-[30%]\">Amount</p>\n                </div>\n                <div class=\"h-[82%] overflow-y-scroll scrollbar-hide\">\n                    <div v-for=\"invoice in filteredInvoices\" :key=\"invoice.name\" class=\"flex flex-col\">\n                        <div class=\"flex justify-evenly rounded bg-blue-200 p-2.5 my-2\">\n                            <div class=\"w-[10%]\">\n                                <input type=\"radio\" name=\"selectedInvoice\" :value=\"invoice.name\"\n                                    class=\"text-black hover:text-black\" v-model=\"selectedInvoice\" />\n                            </div>\n                            <p class=\"w-[30%]\">{{ invoice.name }}</p>\n                            <p class=\"w-[30%]\">{{ invoice.customer }}</p>\n                            <p class=\"w-[30%]\">{{ invoice.grand_total }}</p>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"flex justify-between items-center mt-4\">\n                    <div class=\"flex gap-2\">\n                        <Button\n                            v-for=\"size in [20, 100, 500, 2500]\"\n                            :key=\"size\"\n                            :variant=\"selectedPageLength === size ? 'solid' : 'ghost'\"\n                            @click=\"setPageLength(size)\"\n                            :ref_for=\"true\"\n                            :loading=\"invoices.loading\"\n                            :disabled=\"invoices.loading\"\n                            :link=\"null\"\n                        >\n                            {{ size }}\n                        </Button>\n\n                    </div>\n                    <Button \n                        @click=\"invoices.next()\" \n                        variant=\"solid\"\n                        :loading=\"invoices.loading\"\n                        :disabled=\"invoices.loading\"\n                    \n                    >\n                        Next\n                    </Button>\n                </div>\n            </div>\n        </template>\n        <template #actions>\n            <div class=\"\">\n                <Button variant=\"solid\" @click=\"submitInvoice\">Select</Button>\n                <Button class=\"ml-2\" @click=\"handleDialogClose\">Close</Button>\n            </div>\n        </template>\n    </Dialog>\n</template>\n\n<script setup>\nimport { Dialog, Button, createListResource, createResource, TextInput, debounce, FeatherIcon } from 'frappe-ui';\nimport { ref, inject, computed, watch, onMounted } from 'vue';\nimport { createToast } from '../../utils';\n\nlet base = inject('base');\nconst dialogVisible = ref(true);\nconst selectedInvoice = ref(null);\nconst searchQuery = ref(\"\");\nconst selectedPageLength = ref(20);\nlet errorHandled = false;\n\nconst handleDialogClose = () => { dialogVisible.value = false; };\nconst setPageLength = (size) => {\n    if (selectedPageLength.value !== size) {\n        selectedPageLength.value = size;\n        invoices.update({ pageLength: size, start: 0 }); \n        invoices.reload();\n    }\n};\nconst submitInvoice = () => {\n    salesInvoice.fetch({ name: selectedInvoice.value });\n};\nlet runDoCMethod = createResource({\n    url: 'run_doc_method',\n    makeParams(params) {\n        return {...params}\n    \n    },\n    transform(data){\n        if (data.docs[0] && data.docs[0].items && data.docs[0].items.length > 0) {\n            data.docs[0].items.forEach(item => {\n                if (item.serial_no) {\n                    item.selected_serial_no = item.serial_no.trim().split('\\n').map(serial => ({\n                        label: serial,\n                        value: serial\n                    }));\n                    \n                }\n                if (item.serial_no){\n                    item._serial=item.serial_no.trim().split('\\n');\n                }\n                if (item.batch_no) {\n                    \n                    item.selected_batch_no = {\n                        label: item.batch_no,\n                        value: item.batch_no\n                    };\n                } else {\n                    item.selected_batch_no = null;\n                }\n                if (!item.custom_id) {\n                    item.custom_id = Date.now() + Math.random();\n                }\n            });\n            \n        }\n\n\n        return data\n    },\n    onSuccess(data){\n        errorHandled = false;\n        addvalues();\n        \n    },\n    onError(error) {\n        createToast({\n            title: 'error',\n            message: Array.isArray(error?.messages) ? error.messages[0] : error?.messages || 'An error occurred',\n            icon: 'x-circle',\n            iconClasses: 'bg-surface-red-5 text-ink-white rounded-md p-px',\n            position: 'top-center',\n            timeout: 5,\n        });\n        errorHandled = true;\n    }\n});\n\nlet salesInvoice = createResource({\n    url: 'frappe.model.mapper.make_mapped_doc',\n    makeParams(params) {\n        return {\n            method: \"erpnext.accounts.doctype.sales_invoice.sales_invoice.make_sales_return\",\n            source_name: params.name,\n            selected_children:{},\n            args:\"\"\n        };\n    },\n    onSuccess: async (data) => {\n        \n        await runDoCMethod.fetch({ for_validate :true, docs: data , method:'set_missing_values' , args: {\"for_validate\":true} });\n        errorHandled = false;  \n    },\n    onError(error) {\n        createToast({\n            title: 'error',\n            message: Array.isArray(error?.messages) ? error.messages[0] : error?.messages || 'An error occurred',\n            icon: 'x-circle',\n            iconClasses: 'bg-surface-red-5 text-ink-white rounded-md p-px',\n            position: 'top-center',\n            timeout: 5,\n        });\n        errorHandled = true;\n    }\n});\n\n\n    const invoices = createListResource({\n    doctype: 'Sales Invoice',\n    fields: ['name', 'customer', 'grand_total'],\n    orderBy: 'creation desc',\n    filters: {\n        docstatus: 1,\n        pos_profile: base.pos_profile.name,\n        is_return: 0,\n        status: ['!=', 'Credit Note Issued']\n    },\n    orFilters: [],\n    pageLength: 20,\n    auto: true\n    });\n\nconst filteredInvoices = computed(() => {\n  if (!searchQuery.value) return invoices.data || [];\n  return (invoices.data || []).filter(invoice =>\n    invoice.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||\n    invoice.customer.toLowerCase().includes(searchQuery.value.toLowerCase())\n  );\n});\n\n\nasync function splitSerialNumbers(serialString = \"\") {\n    if (typeof serialString !== \"string\" || !serialString.trim()) return [];\n    \n    return serialString\n        .trim()\n        .split(\"\\n\")\n        .map(line => line.trim())\n        .filter(line => line !== \"\")\n        .map(serial => ({\n            label: serial,\n            value: serial\n        }));\n}\nconst  addvalues = async ()=>{\n\n    base.invoice =  { ...runDoCMethod.data.docs[0], status: null ,name:\"new-sales-invoice-jpodtuhocv\" }\n    base.items = runDoCMethod.data.docs[0].items || [];\n    base.discount_amount =  runDoCMethod.data.docs[0].discount_amount;\n    base.additional_discount_percentage =  runDoCMethod.data.docs[0].additional_discount_percentage;\n    base.total =  runDoCMethod.data.docs[0].net_total;\n    await get_value.fetch({\n        doctype: \"Customer\",\n        filters: { \"name\": runDoCMethod.data.docs[0].customer },\n        fieldname: ['name', 'mobile_no', 'customer_group', 'territory', 'is_internal_customer'],\n    });\n    base.customer = get_value.data || {};\n    searchQuery.value='';\n    base.is_return = 1; \n    handleDialogClose()\n\n}\n\nlet get_value = createResource({\n        url:'frappe.client.get_value',\n        makeParams(params) {\n        return { ...params }\n        },\n        transform: (data) => {\n            \n                return {\n                label: data.name,\n                value: data.name,\n                mobile_no: data.mobile_no,\n                name: data.name,\n                customer_group: data.customer_group,\n                territory: data.territory,\n                is_internal_customer: data.is_internal_customer,\n                }\n    },\n    onError(error) {\n            createToast({\n                title: 'error',\n                message: Array.isArray(error?.messages) ? error.messages[0] : error?.messages || 'An error occurred',\n                icon: 'x-circle',\n                iconClasses: 'bg-surface-red-5 text-ink-white rounded-md p-px',\n                position: 'top-center',\n                timeout: 5,\n            });\n            errorHandled = true;\n        }\n\n    })\n\nconst updateInvoices = debounce((newQuery) => {\n  invoices.update({\n    filters: {\n      docstatus: 1,\n      pos_profile: base.pos_profile.name,\n      is_return: 0\n    },\n    orFilters: newQuery\n      ? [\n          ['name', 'like', `%${newQuery}%`],\n          ['customer', 'like', `%${newQuery}%`]\n        ]\n      : []\n  });\n  invoices.reload();\n}, 300); \n\nwatch(searchQuery, updateInvoices);\n</script>"],"names":["base","inject","dialogVisible","ref","selectedInvoice","searchQuery","selectedPageLength","handleDialogClose","setPageLength","size","invoices","submitInvoice","salesInvoice","runDoCMethod","createResource","params","data","item","serial","addvalues","error","createToast","createListResource","filteredInvoices","computed","invoice","get_value","updateInvoices","debounce","newQuery","watch","_createBlock","_unref","Dialog","$event","_cache","_createElementVNode","_hoisted_1","_createVNode","TextInput","FeatherIcon","_hoisted_2","_createElementBlock","_Fragment","_renderList","_hoisted_3","_hoisted_4","_hoisted_6","_toDisplayString","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","Button","_hoisted_11"],"mappings":"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"}