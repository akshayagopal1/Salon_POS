import{D as B,r as u,b3 as k,b6 as D,c as N,w as j,U as E,R as m,$ as d,S as a,Z as r,u as o,ac as _,ae as p,aV as F,a8 as P,Q as y,F as C,a9 as V,a0 as R,bb as U,aa as f,ba as M}from"./index-W9TX4JPH.js";import{c as L}from"./Pos-DZFo8QfI.js";const T={class:"w-full h-[60vh] bg-white-overlay-100 rounded-2xl p-3 shadow-2xl flex flex-col gap-4"},H={class:"h-[82%] overflow-y-scroll scrollbar-hide"},Z={class:"flex justify-evenly rounded bg-blue-200 p-2.5 my-2"},q={class:"w-[10%]"},G=["value"],J={class:"w-[30%]"},K={class:"w-[30%]"},O={class:"w-[30%]"},Q={class:"flex justify-between items-center mt-4"},W={class:"flex gap-2"},X={class:""},se={__name:"Held",setup(Y){let n=B("base");const v=u(!0),g=u(null),c=u(""),b=u(20),x=()=>{v.value=!1},A=e=>{b.value!==e&&(b.value=e,l.update({pageLength:e,start:0}),l.reload())},I=()=>{i.fetch({name:g.value})};let i=k({url:"frappe.desk.form.load.getdoc",makeParams(e){return{doctype:"Sales Invoice",name:e.name}},transform(e){return e.docs[0]&&e.docs[0].items&&e.docs[0].items.length>0&&e.docs[0].items.forEach(s=>{s.serial_no&&(s.selected_serial_no=s.serial_no.trim().split(`
`).map(t=>({label:t,value:t}))),s.batch_no?s.selected_batch_no={label:s.batch_no,value:s.batch_no}:s.selected_batch_no=null,s.custom_id||(s.custom_id=Date.now()+Math.random())}),e},onSuccess:async e=>{var s,t;if(!((s=e.docs[0])!=null&&s.items)||!Array.isArray(e.docs[0].items)){console.error("Invalid or missing items array",(t=e.docs[0])==null?void 0:t.items);return}$()},onError(e){L({title:"error",message:Array.isArray(e==null?void 0:e.messages)?e.messages[0]:(e==null?void 0:e.messages)||"An error occurred",icon:"x-circle",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:5})}});const $=async()=>{n.invoice={...i.data.docs[0],status:null},n.is_return=i.data.docs[0].is_return,n.items=i.data.docs[0].items,n.discount_amount=i.data.docs[0].discount_amount,n.additional_discount_percentage=i.data.docs[0].additional_discount_percentage,n.total=i.data.docs[0].net_total,await h.fetch({doctype:"Customer",filters:{name:i.data.docs[0].customer},fieldname:["name","mobile_no","customer_group","territory","is_internal_customer"]}),n.customer=h.data||{},c.value="",x()};let h=k({url:"frappe.client.get_value",makeParams(e){return{...e}},transform:e=>({label:e.name,value:e.name,mobile_no:e.mobile_no,name:e.name,customer_group:e.customer_group,territory:e.territory,is_internal_customer:e.is_internal_customer}),onError(e){L({title:"error",message:Array.isArray(e==null?void 0:e.messages)?e.messages[0]:(e==null?void 0:e.messages)||"An error occurred",icon:"x-circle",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:5})}});const l=D({doctype:"Sales Invoice",fields:["name","customer","grand_total"],orderBy:"creation desc",filters:{docstatus:0,pos_profile:n.pos_profile.name},orFilters:[],pageLength:20,auto:!0}),S=N(()=>c.value?l.data.filter(e=>e.name.toLowerCase().includes(c.value.toLowerCase())||e.customer.toLowerCase().includes(c.value.toLowerCase())):l.data);return j(c,e=>{l.update({filters:{docstatus:0,pos_profile:n.pos_profile.name},orFilters:e?[["name","like",`%${e}%`],["customer","like",`%${e}%`]]:[]}),l.reload()}),(e,s)=>(m(),E(o(M),{options:{size:"3xl"},modelValue:v.value,"onUpdate:modelValue":s[3]||(s[3]=t=>v.value=t),class:"rounded-b"},{"body-title":d(()=>s[4]||(s[4]=[a("p",{class:"text-3xl"},"Select Invoice",-1)])),"body-content":d(()=>[a("div",T,[r(o(F),{type:"text",modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=t=>c.value=t),placeholder:"Search"},{prefix:d(()=>[r(o(P),{class:"w-4",name:"search"})]),_:1},8,["modelValue"]),s[6]||(s[6]=a("div",{class:"flex justify-evenly bg-black-overlay-800 text-white rounded-md p-3 h-[8%]"},[a("div",{class:"w-[10%]"}),a("p",{class:"w-[30%]"},"Name"),a("p",{class:"w-[30%]"},"Customer"),a("p",{class:"w-[30%]"},"Amount")],-1)),a("div",H,[(m(!0),y(C,null,V(S.value,t=>(m(),y("div",{key:t.name,class:"flex flex-col"},[a("div",Z,[a("div",q,[R(a("input",{type:"radio",name:"selectedInvoice",value:t.name,class:"text-black hover:text-black","onUpdate:modelValue":s[1]||(s[1]=w=>g.value=w)},null,8,G),[[U,g.value]])]),a("p",J,f(t.name),1),a("p",K,f(t.customer),1),a("p",O,f(t.grand_total),1)])]))),128))]),a("div",Q,[a("div",W,[(m(),y(C,null,V([20,100,500,2500],t=>r(o(_),{key:t,variant:b.value===t?"solid":"ghost",onClick:w=>A(t),ref_for:!0,loading:o(l).loading,disabled:o(l).loading,link:null},{default:d(()=>[p(f(t),1)]),_:2},1032,["variant","onClick","loading","disabled"])),64))]),r(o(_),{onClick:s[2]||(s[2]=t=>o(l).next()),variant:"solid",loading:o(l).loading,disabled:o(l).loading},{default:d(()=>s[5]||(s[5]=[p(" Next ",-1)])),_:1,__:[5]},8,["loading","disabled"])])])]),actions:d(()=>[a("div",X,[r(o(_),{variant:"solid",onClick:I},{default:d(()=>s[7]||(s[7]=[p("Select",-1)])),_:1,__:[7]}),r(o(_),{class:"ml-2",onClick:x},{default:d(()=>s[8]||(s[8]=[p("Close",-1)])),_:1,__:[8]})])]),_:1},8,["modelValue"]))}};export{se as default};
//# sourceMappingURL=Held-BWML67yd.js.map
